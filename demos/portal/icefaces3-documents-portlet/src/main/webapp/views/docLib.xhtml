<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:ace="http://www.icefaces.org/icefaces/components"
	xmlns:aui="http://liferay.com/faces/aui" xmlns:aui-cc="http://liferay.com/faces/aui-cc"
	xmlns:liferay-ui="http://liferay.com/faces/ui" xmlns:ice="http://www.icesoft.com/icefaces/component"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:icecore="http://www.icefaces.org/icefaces/core"
	xmlns:example-cc="http://java.sun.com/jsf/composite/example-cc">

	<h:messages globalOnly="true" />
	<h:form id="f1" styleClass="aui-form dlp">
		<ace:dialog id="uploadDialog" header="#{i18n['add-document']}" modal="true" widgetVar="uploadDialog" width="500"
			height="170" closable="true" position="center">
			<liferay-ui:info message="#{i18n.replace('upload-documents-no-larger-than-x-k', docLibBackingBean.maxFileSizeKB)}" />
			<ace:fileEntry id="fileEntryComp" absolutePath="#{docLibBackingBean.fileUploadAbsolutePath}"
				fileEntryListener="#{docLibBackingBean.handleFileUpload}" />
			<hr />
			<aui:button-row>
				<h:commandButton onclick="uploadDialog.hide()" value="#{i18n['upload-document']}" />
			</aui:button-row>
		</ace:dialog>
		<ace:dialog id="addFolderDialog" header="#{i18n['add-folder']}" modal="true" widgetVar="addFolderDialog"
			message="#{i18n.replace('upload-documents-no-larger-than-x-k', docUploadBackingBean.maxFileSizeKB)}" width="640"
			height="480" closable="true" position="center">
			<aui-cc:messages globalOnly="true" layout="table" />
			<aui:fieldset label="#{i18n['add-folder']}">
				<ace:textEntry inlineMessage="true" label="#{i18n['folder-name']}" required="#{docLibViewBean.popupRendered}"
					value="#{docLibBackingBean.folderName}" />
				<ace:textEntry inlineMessage="true" label="#{i18n['description']}" required="false" cols="100" rows="10"
					type="textarea" value="#{docLibBackingBean.folderDescription}" />
				<aui:button-row>
					<h:commandButton actionListener="#{docLibBackingBean.addFolder}" onclick="addFolderDialog.hide()"
						value="#{i18n['submit']}" />
				</aui:button-row>
			</aui:fieldset>
		</ace:dialog>
	</h:form>
	<h:form id="f2">
		<h:panelGroup id="pg1">
			<aui:layout id="l1">
				<aui:column columnWidth="25" first="true">
					<liferay-ui:panel-container>
						<liferay-ui:panel title="#{i18n['folders']}">
							<ace:tree id="tree" expansion="true" selection="true" selectMultiple="false" stateMap="#{docLibViewBean.treeNodeStateMap}"
								value="#{docLibModelBean.lazyNodeDataModel}" var="treeNode">
								<ace:ajax event="select" render="@all" execute="@all" listener="#{docLibBackingBean.treeNodeSelected}" />
								<ace:node>
									<h:panelGroup styleClass="folder-node folder-node-expanded-#{docLibViewBean.treeNodeStateMap[treeNode].expanded}">
										<h:outputText styleClass="folder-node-text" value="#{treeNode.userObject.name}" />
									</h:panelGroup>
								</ace:node>
							</ace:tree>
						</liferay-ui:panel>
					</liferay-ui:panel-container>
				</aui:column>
				<aui:column id="c2" columnWidth="50">
					<liferay-ui:panel-container id="pc1">

						<liferay-ui:panel id="p1" styleClass="docPanel" title="#{i18n['documents']}">

							<aui:list styleClass="breadcrumbs breadcrumbs-horizontal lfr-component">
								<ui:repeat value="#{docLibModelBean.breadcrumbFolders}" var="dlFolder">
									<aui:list-item styleClass="#{dlFolder.styleClass}" value="#{dlFolder}">
										<h:commandLink action="#{docLibBackingBean.selectFolder(dlFolder)}" value="#{dlFolder.name}" >
										
										</h:commandLink>
									</aui:list-item>
								</ui:repeat>
							</aui:list>
							<ace:menuBar>
								<ace:submenu id="add" icon="icon-padding liferay-add-icon" label="#{i18n['add']}">
									<ace:menuItem id="addFolder" icon="icon-padding liferay-add-folder-icon" onclick="javascript:addFolderDialog.show();"
										value="#{i18n['add-folder']}">
										<f:setPropertyActionListener for="outLink" value="true" target="#{docLibViewBean.popupRendered}" />
										<ui:remove>
											<ace:ajax event="activate" execute="@this" render="message" />
										</ui:remove>
									</ace:menuItem>
									<ace:menuItem id="addFile" icon="icon-padding liferay-file-entry-icon" onclick="javascript:uploadDialog.show();"
										value="#{i18n['add-file-entry']}">
										<ui:remove>
											<ace:ajax event="activate" execute="@this" render="message" />
										</ui:remove>
									</ace:menuItem>
								</ace:submenu>
								<ace:menuItem id="delete" actionListener="#{docLibBackingBean.delete}"
									disabled="#{!docLibViewBean.filesSelected}" icon="icon-padding liferay-delete-icon" value="#{i18n['delete']}" />
							</ace:menuBar>
							<ace:dataTable id="documents"  lazy="true" paginator="true"  paginatorPosition="top"
								rows="#{docLibModelBean.documentDataModel.rowsPerPage}"
								rowSelectListener="#{docLibViewBean.incrementSelectedFiles}"
								rowUnselectListener="#{docLibViewBean.decrementSelectedFiles}" selectionMode="multiple" singleSort="true"
								value="#{docLibModelBean.documentDataModel}" var="dlFileEntry">
								<ace:column id="fileName" headerText="#{i18n['file-name']}" sortBy="#{dlFileEntry.title}">
									<h:outputLink target="_blank" value="#{dlFileEntry.url}">
										<h:graphicImage alt="#{dlFileEntry.extension}"
											value="#{liferay.themeImagesURL}/file_system/small/#{dlFileEntry.extension}.png" />
										<h:outputText value="#{dlFileEntry.title}" />
									</h:outputLink>
								</ace:column>
								<ace:column id="size" headerText="#{i18n['size']}" sortBy="#{dlFileEntry.kilobytes}">
									<h:outputText value="#{dlFileEntry.kilobytes}" />
								</ace:column>
								<ace:column id="owner" headerText="#{i18n['owner']}" sortBy="#{dlFileEntry.userName}">
									<h:outputText value="#{dlFileEntry.userName}" />
								</ace:column>
								<ace:column id="downloads" headerText="#{i18n['downloads']}" sortBy="#{dlFileEntry.readCount}">
									<h:outputText value="#{dlFileEntry.readCount}" />
								</ace:column>
							</ace:dataTable>
							<liferay-ui:info message="there-are-no-documents" rendered="#{docLibModelBean.documentDataModel.rowCount == 0}" />
						</liferay-ui:panel>
					</liferay-ui:panel-container>
				</aui:column>
				<c:set value="#{docLibModelBean.selectedDlFolder.name}" var="selectedFolderName" />
				<aui:column columnWidth="25" last="true" styleClass="lfr-asset-column lfr-asset-column-actions">
					<h:panelGroup layout="block" styleClass="lfr-asset-summary">
						<h:panelGroup styleClass="lfr-asset-avatar">
							<h:graphicImage alt="#{selectedFolderName}"
								value="#{liferay.themeImagesURL}/file_system/large/folder_full_document.png" />
						</h:panelGroup>
						<h:panelGroup layout="block" styleClass="lfr-asset-name">
							<h4>#{selectedFolderName}</h4>
						</h:panelGroup>
					</h:panelGroup>
					<liferay-ui:icon-menu>
						<liferay-ui:icon href="javascript:addFolderDialog.show();" image="add_folder" message="add-folder">
							<f:setPropertyActionListener for="outLink" value="true" target="#{docLibViewBean.popupRendered}" />
						</liferay-ui:icon>
						<liferay-ui:icon href="javascript:uploadDialog.show();" image="../document_library/add_document"
							message="add-document" />
					</liferay-ui:icon-menu>
				</aui:column>
			</aui:layout>
		</h:panelGroup>
	</h:form>
</ui:composition>
