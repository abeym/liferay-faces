<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:aui="http://liferay.com/faces/aui"
	xmlns:aui-cc="http://liferay.com/faces/aui-cc" xmlns:liferay-ui="http://liferay.com/faces/ui"
	xmlns:ice="http://www.icesoft.com/icefaces/component" xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:icecore="http://www.icefaces.org/icefaces/core" xmlns:ace="http://www.icefaces.org/icefaces/components">
	<aui:importConstants var="UploadedFileUtil" classType="com.liferay.faces.demos.util.UploadedFileUtil" />

	<h:messages globalOnly="true" />
	<h:form id="f1" styleClass="aui-form dlp">
		<ace:dialog id="uploadDialog" header="#{i18n['add-document']}" modal="true" widgetVar="uploadDialog" width="500"
			height="240" closable="true" position="center" visible="#{docLibViewBean.addFileDialogRendered}">
			<ace:ajax event="close" listener="#{docLibBackingBean.setAddFileDialogRenderedFalse}" />
			<aui-cc:messages globalOnly="true" />
			<liferay-ui:info message="#{i18n.replace('upload-documents-no-larger-than-x-k', docLibBackingBean.maxFileSizeKB)}" />
			<ace:fileEntry id="fileEntryComp" absolutePath="#{UploadedFileUtil.JAVA_IO_TMPDIR}"
				fileEntryListener="#{docLibBackingBean.handleFileUpload}" />
			<hr />
			<h:selectOneMenu id="fileEntryTypeId" required="true" value="#{docLibModelBean.fileEntryTypeId}">
				<ui:remove>
					<f:selectItems itemLabel="#{dlFileEntryType.name}" itemValue="dlFileEntryType.Id" />
				</ui:remove>
				<f:selectItems itemValue="#{dlFileEntryType.fileEntryTypeId}" itemLabel="#{dlFileEntryType.name}"
					value="#{docLibViewBean.dlFileEntryTypes}" var="dlFileEntryType" />
			</h:selectOneMenu>
			<hr />
			<aui:button-row>
				<h:commandButton value="#{i18n['upload-document']}" />
				<h:commandButton actionListener="#{docLibBackingBean.cancelFileUpload}" immediate="true" value="#{i18n['cancel']}" />
			</aui:button-row>
		</ace:dialog>
		<ace:dialog id="addFolderDialog" header="#{i18n['add-folder']}" modal="true" widgetVar="addFolderDialog"
			message="#{i18n.replace('upload-documents-no-larger-than-x-k', docUploadBackingBean.maxFileSizeKB)}" width="650"
			height="380" closable="true" position="center" visible="#{docLibViewBean.addFolderDialogRendered}">
			<ace:ajax event="close" listener="#{docLibBackingBean.setAddFolderDialogRenderedFalse}" />
			<aui-cc:messages globalOnly="true" layout="table" />
			<aui:fieldset label="#{i18n['add-folder']}">
				<ace:textEntry label="#{i18n['folder-name']}" labelPosition="top" required="#{docLibViewBean.popupRendered}"
					value="#{docLibBackingBean.folderName}" />
				<h:panelGroup layout="block" />
				<ace:textAreaEntry label="#{i18n['description']}" labelPosition="top" required="false" cols="100" rows="10"
					type="textarea" value="#{docLibBackingBean.folderDescription}" />
				<aui:button-row>
					<h:commandButton actionListener="#{docLibBackingBean.addFolder}" value="#{i18n['submit']}">
						<ui:remove>
							<ace:ajax event="click" render=":f2:l1:c1:pc1:pg2:tree @this" />
						</ui:remove>
					</h:commandButton>
					<h:commandButton action="#{docLibBackingBean.setAddFolderDialogRenderedFalse}" immediate="true"
						value="#{i18n['cancel']}" />
				</aui:button-row>
			</aui:fieldset>
		</ace:dialog>
	</h:form>
	<h:form id="f2">
		<ace:dialog id="deleteFilesDialog" header="#{i18n['delete-file']}(s)?" modal="true" widgetVar="deleteDialog" width="375"
			height="120" closable="true" position="center" visible="#{docLibViewBean.deleteFileDialogRendered}">
			<ace:ajax event="close" listener="#{docLibViewBean.setDeleteFileDialogRenderedFalse}" />
			<aui-cc:messages globalOnly="true" />
			<h:outputText value="#{i18n['are-you-sure-you-want-to-delete-the-selected-entries']}" />
			<aui:button-row>
				<h:commandButton action="#{docLibBackingBean.deleteFiles}" value="#{i18n['delete-file']}(s)" />
				<h:commandButton action="#{docLibViewBean.setDeleteFileDialogRenderedFalse}" value="#{i18n['cancel']}" />
			</aui:button-row>
		</ace:dialog>
		<ace:dialog id="deleteFolderDialog" header="#{i18n['delete-folder']}?" modal="true" widgetVar="deleteDialog" width="500"
			height="115" closable="true" position="center" visible="#{docLibViewBean.deleteFolderDialogRendered}">
			<ace:ajax event="close" listener="#{docLibViewBean.setDeleteFolderDialogRenderedFalse}" /> 
			<aui-cc:messages globalOnly="true" />
			<h:outputText value="#{i18n['are-you-sure-you-want-to-delete-the-selected-folder-and-all-its-contents']}" />
			<aui:button-row>
				<h:commandButton action="#{docLibBackingBean.deleteFolder}" value="#{i18n['delete-folder']}" />
				<h:commandButton action="#{docLibViewBean.setDeleteFolderDialogRenderedFalse}" value="#{i18n['cancel']}" />
			</aui:button-row>
		</ace:dialog>
		<h:panelGroup id="pg1">
			<aui:layout id="l1">
				<c:set value="#{docLibModelBean.selectedFolder.name}" var="selectedFolderName" />
				<aui:column id="c1" columnWidth="33" first="true" styleClass="lfr-asset-column lfr-asset-column-actions">
					<liferay-ui:panel-container id="pc1">
						<liferay-ui:panel id="pg2" title="#{i18n['folders']}">
							<h:panelGroup id="pg3" layout="block" styleClass="lfr-asset-summary">
								<h:panelGroup styleClass="lfr-asset-avatar">
									<h:graphicImage alt="#{selectedFolderName}"
										value="#{liferay.themeImagesURL}/file_system/large/folder_full_document.png" />
								</h:panelGroup>
								<h:panelGroup layout="block" styleClass="lfr-asset-name">
									<h4>#{selectedFolderName}</h4>
								</h:panelGroup>
							</h:panelGroup>
							<ace:tree id="tree" expansion="true" selection="true" selectMultiple="false"
								stateMap="#{docLibViewBean.treeNodeStateMap}" value="#{docLibModelBean.lazyNodeDataModel}" var="treeNode">
								<ace:ajax event="select" render="@all" execute="@all" listener="#{docLibBackingBean.treeNodeSelected}" />
								<ace:node>
									<h:panelGroup
										styleClass="folder-node folder-node-expanded-#{docLibViewBean.treeNodeStateMap[treeNode].expanded}">
										<h:outputText styleClass="folder-node-text" value="#{treeNode.userObject.name}" />
									</h:panelGroup>
								</ace:node>
							</ace:tree>
						</liferay-ui:panel>
					</liferay-ui:panel-container>
				</aui:column>
				<aui:column id="c2" columnWidth="65">
					<ui:remove>
						<!-- Workaround for http://jira.icesoft.org/browse/ICE-9133 is to avoid using liferay-ui:panel -->
					</ui:remove>
					<h:panelGroup layout="block" styleClass="lfr-panel-container">
						<h:panelGroup layout="block" styleClass="lfr-asset-name">
							<h4>#{i18n['files']}</h4>
						</h:panelGroup>
						<h:panelGroup layout="block" styleClass="lfr-panel">
							<h:panelGroup layout="block" styleClass="lfr-panel-content">
								<aui:list styleClass="breadcrumbs breadcrumbs-horizontal lfr-component">
									<ui:repeat value="#{docLibModelBean.breadcrumbFolders}" var="folder">
										<aui:list-item styleClass="#{folder.styleClass}" value="#{folder}">
											<h:commandLink action="#{docLibBackingBean.selectFolder(folder)}" value="#{folder.name}">
											</h:commandLink>
										</aui:list-item>
									</ui:repeat>
								</aui:list>
								<ace:menuBar>
									<ace:submenu id="add" icon="icon-padding liferay-add-icon" label="#{i18n['add']}">
										<ace:menuItem id="addFolder" action="#{docLibBackingBean.setAddFolderDialogRenderedTrue}"
											icon="icon-padding liferay-add-folder-icon" value="#{i18n['add-folder']}">
											<ui:remove>
												<ace:ajax event="activate" execute="@this" render="message" />
											</ui:remove>
										</ace:menuItem>
										<ace:menuItem id="addFile" action="#{docLibBackingBean.setAddFileDialogRenderedTrue}"
											icon="icon-padding liferay-file-entry-icon" value="#{i18n['add-file-entry']}">
											<ui:remove>
												<ace:ajax event="activate" execute="@this" render="message" />
											</ui:remove>
										</ace:menuItem>
									</ace:submenu>
									<ace:menuItem id="delete" actionListener="#{docLibBackingBean.delete}"
										disabled="#{(!docLibViewBean.filesSelected) and docLibViewBean.rootFolderSelected}"
										icon="icon-padding liferay-delete-icon" value="#{i18n['delete']}">
										<ui:remove>
											<ace:ajax event="activate" update="documents" execute="@all" />
										</ui:remove>
									</ace:menuItem>
								</ace:menuBar>
								<ace:dataTable id="documents" lazy="true" paginator="true" paginatorPosition="top"
									rows="#{docLibModelBean.documentDataModel.rowsPerPage}"
									rowSelectListener="#{docLibViewBean.incrementSelectedFiles}"
									rowUnselectListener="#{docLibViewBean.decrementSelectedFiles}" selectionMode="multiple" singleSort="true"
									value="#{docLibModelBean.documentDataModel}" var="uiFileEntry">
									<ace:column id="fileName" headerText="#{i18n['file-name']}" sortBy="#{uiFileEntry.title}">
										<h:outputLink target="_blank" value="#{uiFileEntry.url}">
											<h:graphicImage alt="#{uiFileEntry.extension}"
												value="#{liferay.themeImagesURL}/file_system/small/#{uiFileEntry.extension}.png" />
											<h:outputText value="#{uiFileEntry.title}" />
										</h:outputLink>
									</ace:column>
									<ace:column id="size" headerText="#{i18n['size']}" sortBy="#{uiFileEntry.kilobytes}">
										<h:outputText value="#{uiFileEntry.kilobytes}" />
									</ace:column>
									<ace:column id="owner" headerText="#{i18n['owner']}" sortBy="#{uiFileEntry.userName}">
										<h:outputText value="#{uiFileEntry.userName}" />
									</ace:column>
									<ace:column id="downloads" headerText="#{i18n['downloads']}" sortBy="#{uiFileEntry.readCount}">
										<h:outputText value="#{uiFileEntry.readCount}" />
									</ace:column>
								</ace:dataTable>
								<liferay-ui:info message="there-are-no-documents" rendered="#{docLibModelBean.documentDataModel.rowCount == 0}" />
							</h:panelGroup>
						</h:panelGroup>
					</h:panelGroup>
				</aui:column>
				<c:set value="#{docLibModelBean.selectedfolder.name}" var="selectedFolderName" />
			</aui:layout>
		</h:panelGroup>
	</h:form>
</ui:composition>
